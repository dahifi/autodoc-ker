{
  "fileName": "particle_stretch.js",
  "filePath": "src/scene/shader-lib/chunks/particle/vert/particle_stretch.js",
  "url": "https://github.com/playcanvas/engine/src/scene/shader-lib/chunks/particle/vert/particle_stretch.js",
  "summary": "This code is written in GLSL and is used for particle animation in the PlayCanvas engine. The purpose of this code is to calculate the new position of a particle based on its previous position, velocity, and stretch factor. \n\nThe code starts by calculating the movement direction of the particle using the input velocity and stretch factor. It then calculates the previous position of the particle by subtracting the movement direction from the current position and adding the position moved by the particle. \n\nNext, the code calculates the vector from the center of the particle to its vertex in screen space. This is done by multiplying the local position of the particle by the view matrix and taking the x and y components of the resulting vector. The resulting vector is then normalized. \n\nFinally, the code calculates the interpolation factor between the previous position and the current position of the particle. This is done by taking the dot product of the negative velocity vector and the vector from the center of the particle to its vertex. The resulting value is then multiplied by 0.5 and added to 0.5 to get a value between 0 and 1. This value is then used to interpolate between the previous position and the current position of the particle using the mix function. \n\nThis code is used in the larger PlayCanvas engine project to animate particles in various ways. For example, it could be used to simulate the movement of smoke particles in a game or the motion of particles in a particle system. \n\nHere is an example of how this code could be used in a particle system:\n\n```glsl\nuniform float stretch;\nuniform vec3 inVel;\nuniform vec3 particlePos;\nuniform vec3 particlePosMoved;\nuniform mat4 matrix_view;\nuniform vec3 velocityV;\nuniform vec3 localPos;\n\nvec3 moveDir = inVel * stretch;\nvec3 posPrev = particlePos - moveDir;\nposPrev += particlePosMoved;\n\nvec2 centerToVertexV = normalize((mat3(matrix_view) * localPos).xy);\n\nfloat interpolation = dot(-velocityV, centerToVertexV) * 0.5 + 0.5;\n\nparticlePos = mix(particlePos, posPrev, interpolation);\n```\n\nIn this example, the uniforms are passed in to the shader from the CPU. The resulting particle position is then used to render the particle in the game.",
  "questions": "1. What is the purpose of this code?\n   - This code is likely part of a particle system in the PlayCanvas engine, and it appears to be calculating the new position of a particle based on its previous position, velocity, and stretch.\n\n2. What do the variables \"inVel\" and \"stretch\" represent?\n   - Without additional context, it's unclear what these variables represent. It's possible that \"inVel\" refers to the input velocity of the particle, while \"stretch\" could be a scalar value that affects how much the particle stretches as it moves.\n\n3. What is the significance of the \"interpolation\" variable?\n   - The \"interpolation\" variable appears to be used to blend between the particle's current position and its previous position, based on the dot product between its velocity and the vector from the camera to the particle's position. However, it's unclear why this blending is necessary or how it affects the particle's behavior."
}